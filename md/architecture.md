## â™Šï¸ Gemini Chat Exporter: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ ğŸš€

Vite + React + TypeScript + MUI ã‚’ä½¿ç”¨ã—ãŸ Chrome æ‹¡å¼µæ©Ÿèƒ½ã€Œgemini-chat-exporterã€ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã”ææ¡ˆã—ã¾ã™ã€‚

---

### ğŸ›ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ä¸»ã«ä»¥ä¸‹ã®3ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¾ã™ã€‚

1.  **Popup (ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—)**:
    * **å½¹å‰²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (UI) ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã“ã“ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ“ä½œã‚’é–‹å§‹ã—ã€å½¢å¼ï¼ˆMarkdown, JSON, Textãªã©ï¼‰ã‚’é¸æŠã—ã¾ã™ã€‚
    * **æŠ€è¡“**: React + TypeScript + MUI ã§æ§‹ç¯‰ã—ã¾ã™ã€‚Vite ã«ã‚ˆã£ã¦ `popup.html` ã¨é–¢é€£ã™ã‚‹ React ã‚³ãƒ¼ãƒ‰ãŒãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¾ã™ã€‚
    * **å‹•ä½œ**:
        * æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        * ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã‚‹ã¨ã€Content Script ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãƒãƒ£ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’è¦æ±‚ã—ã¾ã™ã€‚
        * Content Script ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆä»»æ„ï¼‰ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å‡¦ç†ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚

2.  **Content Script (ã‚³ãƒ³ãƒ†ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ)**:
    * **å½¹å‰²**: å®Ÿéš›ã« Gemini ã® Web ãƒšãƒ¼ã‚¸ (gemini.google.com) ã«æŒ¿å…¥ã•ã‚Œã€ãƒãƒ£ãƒƒãƒˆã® DOM (Document Object Model) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ä¼šè©±ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
    * **æŠ€è¡“**: TypeScript ã§è¨˜è¿°ã—ã¾ã™ã€‚Vite ã«ã‚ˆã£ã¦ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¾ã™ã€‚
    * **å‹•ä½œ**:
        * `manifest.json` ã®è¨­å®šã«åŸºã¥ãã€Gemini ã®ãƒšãƒ¼ã‚¸ãŒé–‹ã‹ã‚ŒãŸã¨ãã«è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
        * Popup ã¾ãŸã¯ Background Script ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Šã€ç¾åœ¨ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ DOM ã‹ã‚‰è§£æãƒ»æŠ½å‡ºã—ã¾ã™ã€‚
        * æŠ½å‡ºã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡å…ƒï¼ˆPopup ãªã©ï¼‰ã«è¿”ä¿¡ã—ã¾ã™ã€‚
        * Gemini ã® UI ã¯å‹•çš„ã«å¤‰åŒ–ã™ã‚‹ãŸã‚ã€`MutationObserver` ãªã©ã‚’ä½¿ç”¨ã—ã¦ãƒãƒ£ãƒƒãƒˆã®æ›´æ–°ã‚’ç›£è¦–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

3.  **Background Script (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ) - (ä»»æ„ã ãŒæ¨å¥¨)**:
    * **å½¹å‰²**: æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ä½œã—ã€æ°¸ç¶šçš„ãªã‚¿ã‚¹ã‚¯ã‚„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€šä¿¡ã‚’ç®¡ç†ã—ã¾ã™ã€‚ç‰¹ã«ã€`chrome.downloads` API ã‚’ä½¿ç”¨ã—ãŸç¢ºå®Ÿãªãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã‚„ã€è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…ã„ã¾ã™ã€‚
    * **æŠ€è¡“**: TypeScript ã§è¨˜è¿°ã—ã¾ã™ã€‚Vite ã«ã‚ˆã£ã¦ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¾ã™ã€‚
    * **å‹•ä½œ**:
        * Popup ã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã¾ã™ã€‚
        * Content Script ã«ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’æŒ‡ç¤ºã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚
        * å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®šã•ã‚ŒãŸå½¢å¼ã«å¤‰æ›ã—ã¾ã™ã€‚
        * `chrome.downloads.download()` API ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã¾ã™ã€‚
        * ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰å°†æ¥çš„ã«è¨­å®šä¿å­˜ (`chrome.storage`) ãªã©ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã«ã‚‚åˆ©ç”¨ã—ã¾ã™ã€‚

**é€šä¿¡ãƒ•ãƒ­ãƒ¼:**

```mermaid
graph TD
    A[Popup (UI)] -- 1. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¦æ±‚ --> B{Background Script};
    B -- 2. ãƒ‡ãƒ¼ã‚¿å–å¾—è¦æ±‚ --> C[Content Script (Geminiä¸Š)];
    C -- 3. DOMè§£æ & ãƒ‡ãƒ¼ã‚¿æŠ½å‡º --> C;
    C -- 4. ãƒãƒ£ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿é€ä¿¡ --> B;
    B -- 5. ãƒ‡ãƒ¼ã‚¿æ•´å½¢ & ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ --> B;
    B -- 6. chrome.downloads.download() --> D[ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜];
```

* *ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã§ã¯ Popup ã¨ Content Script ãŒç›´æ¥é€šä¿¡ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€Background Script ã‚’çµŒç”±ã™ã‚‹æ–¹ãŒ `chrome` API ã®åˆ©ç”¨ã‚„å‡¦ç†ã®åˆ†é›¢ã®è¦³ç‚¹ã‹ã‚‰æ¨å¥¨ã•ã‚Œã¾ã™ã€‚*

---

### ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ï¼†ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

Vite ã‚’ä½¿ã£ãŸä¸€èˆ¬çš„ãª React + TS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã€Chrome æ‹¡å¼µæ©Ÿèƒ½ã®è¦ä»¶ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
gemini-chat-exporter/
â”œâ”€â”€ public/                 # ãƒ“ãƒ«ãƒ‰æ™‚ã« dist/ ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ manifest.json       # æ‹¡å¼µæ©Ÿèƒ½ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ« âœ¨
â”‚   â”œâ”€â”€ icons/              # æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³
â”‚   â”‚   â”œâ”€â”€ icon16.png
â”‚   â”‚   â”œâ”€â”€ icon48.png
â”‚   â”‚   â””â”€â”€ icon128.png
â”‚   â””â”€â”€ popup.html          # Popup ã® HTML (Reactã‚¢ãƒ—ãƒªã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆ)
â”‚
â”œâ”€â”€ src/                    # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ popup/              # Popup é–¢é€£
â”‚   â”‚   â”œâ”€â”€ main.tsx        # React ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (popup.htmlã‹ã‚‰èª­ã¿è¾¼ã‚€)
â”‚   â”‚   â”œâ”€â”€ App.tsx         # Popup ã®ãƒ¡ã‚¤ãƒ³Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ components/     # Popup ç”¨ã® React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ ExportButton.tsx
â”‚   â”‚   â””â”€â”€ theme.ts        # MUI ã®ãƒ†ãƒ¼ãƒè¨­å®š
â”‚   â”‚
â”‚   â”œâ”€â”€ content/            # Content Script é–¢é€£
â”‚   â”‚   â””â”€â”€ index.ts        # Content Script ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ ğŸ”
â”‚   â”‚
â”‚   â”œâ”€â”€ background/         # Background Script é–¢é€£
â”‚   â”‚   â””â”€â”€ index.ts        # Background Script ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ âš™ï¸
â”‚   â”‚
â”‚   â”œâ”€â”€ types/              # å…±é€šã®å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ chat.ts         # ãƒãƒ£ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®å‹ãªã©
â”‚   â”‚
â”‚   â””â”€â”€ utils/              # å…±é€šã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚       â””â”€â”€ fileSaver.ts    # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ãªã©
â”‚
â”œâ”€â”€ dist/                   # ãƒ“ãƒ«ãƒ‰å¾Œã®å‡ºåŠ›å…ˆ (ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ‹¡å¼µæ©Ÿèƒ½ã¨ã—ã¦èª­ã¿è¾¼ã‚€)
â”œâ”€â”€ package.json            # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã€ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ vite.config.ts          # Vite ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« ğŸ› ï¸
â”œâ”€â”€ tsconfig.json           # TypeScript ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ README.md               # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª¬æ˜
```

---

### âœ¨ `manifest.json` (v3) ã®ä¸»è¦ãªè¨­å®š

```json
{
  "manifest_version": 3,
  "name": "Gemini Chat Exporter",
  "version": "0.1.0",
  "description": "Export your Gemini chat conversations.",
  "permissions": [
    "activeTab",    // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ (Content Script å®Ÿè¡Œã«å¿…è¦)
    "scripting",    // ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥ (Content Script å®Ÿè¡Œã«å¿…è¦)
    "downloads"     // chrome.downloads API ã‚’ä½¿ã†å ´åˆã«å¿…è¦
    // "storage"      // è¨­å®šä¿å­˜ã‚’è¡Œã†å ´åˆã«å¿…è¦
  ],
  "host_permissions": [
    "https://gemini.google.com/*" // Content Script ã‚’å®Ÿè¡Œã™ã‚‹å¯¾è±¡ã‚µã‚¤ãƒˆ
  ],
  "action": {
    "default_popup": "popup.html", // Popup ã® HTML ã‚’æŒ‡å®š
    "default_icon": {
      "16": "icons/icon16.png",
      "48": "icons/icon48.png",
      "128": "icons/icon128.png"
    }
  },
  "background": {
    "service_worker": "background/index.js" // Background Script ã‚’æŒ‡å®š (ãƒ“ãƒ«ãƒ‰å¾Œã®ãƒ‘ã‚¹)
  },
  "content_scripts": [
    {
      "matches": ["https://gemini.google.com/*"],
      // JS ã¯ Vite ãŒãƒ“ãƒ«ãƒ‰æ™‚ã«æŒ¿å…¥ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã‹ã€ã“ã“ã§æŒ‡å®š
      // "js": ["content/index.js"],
      "run_at": "document_idle" // ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¦ã‹ã‚‰å®Ÿè¡Œ
    }
  ]
}
```

* **æ³¨æ„:** Vite ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹å ´åˆã€`manifest.json` ã® `background` ã‚„ `content_scripts` ã® `js` ãƒ‘ã‚¹ã¯ã€Vite ã®ãƒ“ãƒ«ãƒ‰è¨­å®š (`vite.config.ts`) ã§é©åˆ‡ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å¤šãã®å ´åˆã€`vite.config.ts` ã§è¤‡æ•°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®šã—ã€`manifest.json` ã¯ `public` ã«ç½®ã„ã¦ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚Content Script ã¯ `chrome.scripting.executeScript` ã‚’ä½¿ã£ã¦ Background Script ã‹ã‚‰å‹•çš„ã«æ³¨å…¥ã™ã‚‹æ–¹æ³•ã‚‚ä¸€èˆ¬çš„ã§ã™ã€‚

---

### ğŸ› ï¸ `vite.config.ts` ã®ãƒã‚¤ãƒ³ãƒˆ

Vite ã§ Chrome æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯ã€è¤‡æ•°ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆPopup, Content Script, Background Scriptï¼‰ã‚’æ‰±ãˆã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`vite-plugin-crx` ãªã©ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ãŒã€æ‰‹å‹•ã§è¨­å®šã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªç‚¹ã‚’è€ƒæ…®ã—ã¾ã™ã€‚

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      input: {
        popup: resolve(__dirname, 'popup.html'), // Popupã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼
        content: resolve(__dirname, 'src/content/index.ts'), // Content Script
        background: resolve(__dirname, 'src/background/index.ts'), // Background Script
      },
      output: {
        entryFileNames: `[name]/index.js`, // å„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘ã—ã¦å‡ºåŠ›
        chunkFileNames: `assets/[name].js`,
        assetFileNames: `assets/[name].[ext]`,
      },
    },
    outDir: 'dist', // å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    emptyOutDir: true, // ãƒ“ãƒ«ãƒ‰æ™‚ã« dist ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  },
  // ... ãã®ä»–è¨­å®š
});
```

* *ã“ã‚Œã¯åŸºæœ¬çš„ãªä¾‹ã§ã™ã€‚å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€`manifest.json` ã®ã‚³ãƒ”ãƒ¼ã‚„ CSS ã®æ‰±ã„ãªã©ã€ã•ã‚‰ã«è©³ç´°ãªè¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚*

---

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã€Gemini ã® DOM æ§‹é€ ã‚’è§£æã™ã‚‹éƒ¨åˆ† (Content Script) ã¨ã€MUI ã‚’ä½¿ã£ãŸ Popup ã® UI æ§‹ç¯‰ã‚’é€²ã‚ã¦ã„ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚é ‘å¼µã£ã¦ãã ã•ã„ï¼ğŸ’ª
